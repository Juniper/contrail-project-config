---
- hosts: all
  vars:
    src_dir_json_query: "[?short_name=='contrail-infra-doc'].src_dir"
  roles:
    - role: fetch-docs
      fetch_src_path: "{{ zuul.projects | json_query(src_dir_json_query) | first }}/build/html"
      fetch_dst_path: '{{ zuul.executor.work_root }}/build/'

- hosts: localhost
  roles:
    - role: add-fileserver
      fileserver: '{{ site_logs }}'

- hosts: '{{ site_logs.fqdn }}'
  gather_facts: False
  roles:
    - role: upload-docs
      zuul_docserver_root: '/var/www/static/infra-doc'
      docs_dir: '{{ zuul.executor.work_root }}/build/html/'

